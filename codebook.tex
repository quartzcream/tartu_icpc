\documentclass[a4paper]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{titlesec}
\usepackage{enumerate}
\usepackage{amsmath, amsfonts, amssymb, amsthm}
\usepackage{mathtools}
\usepackage{graphicx}
\usepackage{pdfpages}
\usepackage{forloop}
\usepackage{hyperref}
\usepackage{pdflscape}
\usepackage{multicol}
\usepackage{lmodern}

\usepackage{physics}
\usepackage{harpoon}
\renewcommand{\le}{\leqslant}
\renewcommand{\ge}{\geqslant}
\renewcommand{\epsilon}{\varepsilon}
\renewcommand{\phi}{\varphi}
\renewcommand{\theta}{\vartheta}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\qed}{\hfill$\blacksquare$}
\newcommand{\amp}{\, \& \,}
\newcommand{\imp}{\Rightarrow}
\renewcommand{\O}{\mathcal{O}}
\usepackage{listings}
\usepackage{xcolor}
\lstset{language=C++,
  aboveskip=0mm,belowskip=0mm,
  basicstyle=\footnotesize\ttfamily,
  keywordstyle=\color{blue}\ttfamily,
  stringstyle=\color{purple}\ttfamily,
  commentstyle=\color{red}\ttfamily,
  breaklines = true}
\renewcommand{\theenumi}{\alph{enumi}}
\DeclareMathOperator{\orient}{orient}
\DeclareMathOperator{\side}{side}
\DeclareMathOperator{\dist}{dist}
\DeclareMathOperator{\prp}{perp}
%\newcommand*{\vv}[1]{\overrightharp{\ensuremath{#1}}}
\newcommand{\vv}[1]{\overline{#1}}
\usepackage{setspace}

\numberwithin{equation}{section} % Number equations within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
\numberwithin{figure}{section} % Number figures within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
\numberwithin{table}{section} % Number tables within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)

\usepackage[hmarginratio=1:1,top=19mm, bottom=10mm, columnsep=0mm, left=10mm, right=15mm]{geometry} % Document margins
\usepackage[hang, small,labelfont=bf,up,textfont=it,up]{caption} % Custom captions under/above floats in tables or figures
\usepackage{booktabs} % Horizontal rules in tables

\usepackage{enumitem} % Customized lists
\setlist[itemize]{noitemsep} % Make itemize lists more compact
\usepackage{fancyhdr} % Proper control over header
\usepackage{microtype}
\usepackage{tocloft}

\usepackage{minted}
\usepackage{etoolbox}

\AtBeginEnvironment{minted}{\fontsize{10}{10}\selectfont}
\BeforeBeginEnvironment{minted}{\vspace*{-2.5mm}}
\AfterEndEnvironment{minted}{\vspace*{-4.5mm}}
\usemintedstyle{emacs}

\titleformat*{\section}{\bfseries}
\titlespacing*{\section}{0mm}{2mm}{0ex}

\title{\textbf{University of Tartu ICPC Team Notebook (2018-2019)}}
\date{\today}

\pagestyle{fancy}
\fancyhf{}
\lhead{University of Tartu}
\rhead{\thepage}
\setlength{\headsep}{2mm}

\hyphenpenalty=2000
\exhyphenpenalty=2000
\tolerance=2000
\emergencystretch=10pt
\binoppenalty=10
\relpenalty=10



\renewcommand\cftsecfont{\small}

\renewcommand\cftsecpagefont{\small}

\setlength{\cftbeforesecskip}{0pt}
\renewcommand\cftsecbeforepnum{\vskip 0pt}
\renewcommand\cftsecafterpnum{\vskip 0pt}




\makeatletter
\let\latexl@section\l@section
\def\l@section#1#2{\begingroup\let\numberline\@gobble\latexl@section{#1}{#2}\endgroup}
\def\@seccntformat#1{\ifcsname #1format\endcsname\else\csname the#1\endcsname\quad\fi}
\def\sectionformat{}
\makeatother


\addto\captionsenglish{% Replace "english" with the language you use
  \renewcommand{\contentsname}%
    {}%
}
\begin{document} 
\pagenumbering{gobble} 

\begin{landscape}
\setlength{\columnsep}{4mm}
\setlength{\columnseprule}{0.4pt}
\begin{multicols}{3}

\begin{center}
	\smallskip
  \Large{\textbf{University of Tartu ICPC Team Notebook (2018-2019)}}

	\today
\end{center}
 
\begingroup
\let\clearpage\relax
\vspace{-10mm} % the removed space. Set as appropriate
\tableofcontents
\endgroup
\pagenumbering{arabic}  

% \par\noindent\rule{\textwidth}{0.4pt}

\section{Maxflow Complexity}
\begin{description}[align=left]
  \item [$\mathcal{O}(V^2E)$] -- Dinic
  \item [$\Theta({VE \log U})$] -- Capacity scaling
  \item [$\Theta(\text{flow}E)$] -- Small flow
  \item [$\Theta(\min\{V^{\frac{2}{3}},E^{\frac{1}{2}}\}E)$] -- Unitary capacities
  \item [$\Theta(\sqrt{V}E)$] -- Each vertex other than S,T has only a single incoming unitary edge or outgoing one (bipartite matching)
  \item [$\Theta(\text{flow}E \log V)$] -- Min-cost-max flow
\end{description}
\includegraphics[scale=0.3]{LRflow.pdf}
\section{Min Rotation of string}
\begin{lstlisting}
int a=0, N=s.size();
s += s;
ran(b,0,N){
  ran(i,0,N) {
    if (a+i == b || s[a+i] < s[b+i]) {
      b += max(0, i-1);
      break;
    }
    if (s[a+i] > s[b+i]) {
      a = b;
      break;
    }
  }
}
return a;
\end{lstlisting}
\unboldmath
\setlength\columnsep{10mm}
\section{Series} 
$$e^x = 1+x+\frac{x^2}{2!}+\frac{x^3}{3!}+\dots,\,(-\infty<x<\infty)$$
$$\ln(1+x) = x-\frac{x^2}{2}+\frac{x^3}{3}-\frac{x^4}{4}+\dots,\,(-1<x\leq1)$$
$$\sqrt{1+x} = 1+\frac{x}{2}-\frac{x^2}{8}+\frac{2x^3}{32}-\frac{5x^4}{128}+\dots,\,(-1\leq x\leq1)$$
$$\sin x = x-\frac{x^3}{3!}+\frac{x^5}{5!}-\frac{x^7}{7!}+\dots,\,(-\infty<x<\infty)$$
$$\cos x = 1-\frac{x^2}{2!}+\frac{x^4}{4!}-\frac{x^6}{6!}+\dots,\,(-\infty<x<\infty)$$
\section{Symmetric Submodular Functions; Queyrannes's algorithm}

\noindent {\bf SSF}: such function $f : V \rightarrow R$ that satisfies $f(A) = f(V/A)$
and for all $x \in V, X \subseteq Y \subseteq V$ it holds that
$f(X+x) - f(X) \leq f(Y+x) - f(Y)$.

\noindent {\bf Hereditary family}: such set $I \subseteq 2^V$ so that $X \subset Y \wedge Y \in I \Rightarrow X \in I$.

\noindent {\bf Loop}: such $v \in V$ so that ${v} \notin I$.

\begin{minted}[tabsize=2,baselinestretch=1, breaklines, texcomments=true, mathescape=true]{python}
def minimize():
	s = merge_all_loops()
	while size >= 3:
		t, u = find_pp()
		{u} is a possible minimizer
		tu = merge(t, u)
		if tu not in I:
			s = merge(tu, s)
	for x in V:
		{x} is a possible minimizer
def find_pp():
	W = {s} # s as in minimizer()
	todo = V/W
	ord = []
	while len(todo) > 0:
		x = min(todo, key=lambda x: f(W+{x}) - f({x}))
		W += {x}
		todo -= {x}
		ord.append(x)
	return ord[-1], ord[-2]

def enum_all_minimal_minimizers(X): 
  # X is a inclusionwise minimal minimizer
	s = merge(s, X)
	yield X
	for {v} in I:
		if f({v}) == f(X):
			yield X
			s = merge(v, s)
	while size(V) >= 3:
		t, u = find_pp()
		tu = merge(t, u)
		if tu not in I:
			s = merge(tu, s)
		elif f({tu}) = f(X):
			yield tu
			s = merge(tu, s)
\end{minted}

\section{Subset convolution $\mathcal{O}(N\log N)$}

$\displaystyle c[z] = \sum\nolimits_{z = x \oplus y}
a[x] \cdot b[y]$, where $\oplus$ is one of AND, OR, XOR.
The size of $a$ must be a power of two. 

\begin{minted}[tabsize=2,baselinestretch=1, breaklines, texcomments=true, mathescape=true]{c++}
void FST(vi& a, bool inv) { //size(a) == $2^x$
  for (int n =(int)a.size(), step = 1; step < n; step *= 2) {
    for (int i = 0; i < n; i += 2 * step)
      ran(j, i, i + step) {
        int &u = a[j], &v = a[j + step];
        tie(u, v) =
          inv ? pii(v - u, u) : pii(v, u + v); // AND
          inv ? pii(v, u - v) : pii(u + v, u);   // OR
          pii(u + v, u - v);                     // XOR
      }
  }
  if (inv) trav(x, a) x /= a.size(); // XOR only
}
vi conv(vi a, vi b) {
  FST(a, 0);
  FST(b, 0);
  ran(i, 0, (int)a.size()) a[i] *= b[i];
  FST(a, 1);
  return a;
}
\end{minted}
\section{Pythagorean Triples}
 The Pythagorean triples are uniquely generated by
 \[ a=k\cdot (m^{2}-n^{2}),\ \,b=k\cdot (2mn),\ \,c=k\cdot (m^{2}+n^{2}), \]
 with $m > n > 0$, $k > 0$, $m \bot n$, and either $m$ or $n$ even.

\section{Primes}
	$p=962592769$ is such that $2^{21} \mid p-1$, which may be useful. For hashing
	use 970592641 (31-bit number), 31443539979727 (45-bit), 3006703054056749
	(52-bit). There are 78498 primes less than 1\,000\,000.

	Primitive roots exist modulo any prime power $p^a$, except for $p = 2, a > 2$, and there are $\phi(\phi(p^a))$ many.
	For $p = 2, a > 2$, the group $\mathbb Z_{2^a}^\times$ is instead isomorphic to $\mathbb Z_2 \times \mathbb Z_{2^{a-2}}$.

\section{Estimates}
	$\sum_{d|n} d = O(n \log \log n)$.

	The number of divisors of $n$ is at most around 100 for $n < 5e4$, 500 for $n < 1e7$, 2000 for $n < 1e10$, 200\,000 for $n < 1e19$.
	\section{Derangements}
		Permutations of a set such that none of the elements appear in their original position.
\[
	\begin{split}
		\mkern-2mu D(n) = (n-1)(D(n-1)+D(n-2)) = \\
		n D(n-1)+(-1)^n = \left\lfloor\frac{n!}{e}\right\rceil
	\end{split}
\]
	\section{Burnside's lemma}
		Given a group $G$ of symmetries and a set $X$, the number of elements of $X$ \emph{up to symmetry} equals
		 \[ {\frac {1}{|G|}}\sum _{{g\in G}}|X^{g}|, \]
		 where $X^{g}$ are the elements fixed by $g$ ($g.x = x$).

		 If $f(n)$ counts ``configurations'' (of some sort) of length $n$, we can ignore rotational symmetry using $G = \mathbb Z_n$ to get
		 \[ g(n) = \frac 1 n \sum_{k=0}^{n-1}{f(\text{gcd}(n, k))} = \frac 1 n \sum_{k|n}{f(k)\phi(n/k)}. \]

\section{Partition function}
		Number of ways of writing $n$ as a sum of positive integers, disregarding the order of the summands.
\[
\begin{split}
		p(0) = 1, p(n) = \sum_{k \in \mathbb Z \setminus \{0\}}{(-1)^{k+1} p(n - k(3k-1) / 2)}
\end{split}
\]
		\[ p(n) \sim 0.145 / n \cdot \exp(2.56 \sqrt{n}) \]

		\begin{center}
		\begin{tabular}{c|c@{\ }c@{\ }c@{\ }c@{\ }c@{\ }c@{\ }c@{\ }c@{\ }c@{\ }c@{\ }c@{\ }c@{\ }c}
			$n$    & 0 & 1 & 2 & 3 & 4 & 5 & 6  & 7  & 8  & 9  & 20  & 50  & 100 \\ \hline
			$p(n)$ & 1 & 1 & 2 & 3 & 5 & 7 & 11 & 15 & 22 & 30 & 627 & $\mathtt{\sim}$2e5 & $\mathtt{\sim}$2e8 \\
		\end{tabular}
		\end{center}
	\section{Stirling numbers of the first kind}
		Number of permutations on $n$ items with $k$ cycles.
		\begin{align*}
			&c(n,k) = c(n-1,k-1) + (n-1) c(n-1,k),\ c(0,0) = 1 \\
			&\textstyle \sum_{k=0}^n c(n,k)x^k = x(x+1) \dots (x+n-1)
		\end{align*}
		$c(8,k) = 8, 0, 5040, 13068, 13132, 6769, 1960, 322, 28, 1$ \\
		$c(n,2) = 0, 0, 1, 3, 11, 50, 274, 1764, 13068, 109584, \dots$

	\section{Eulerian numbers}
		Number of permutations $\pi \in S_n$ in which exactly $k$ elements are greater than the previous element. $k$ $j$:s s.t. $\pi(j)>\pi(j+1)$, $k+1$ $j$:s s.t. $\pi(j)\geq j$, $k$ $j$:s s.t. $\pi(j)>j$.
		$$E(n,k) = (n-k)E(n-1,k-1) + (k+1)E(n-1,k)$$
		$$E(n,0) = E(n,n-1) = 1$$
		$$E(n,k) = \sum_{j=0}^k(-1)^j\binom{n+1}{j}(k+1-j)^n$$

	\section{Stirling numbers of the second kind}
		Partitions of $n$ distinct elements into exactly $k$ groups.
		$$S(n,k) = S(n-1,k-1) + k S(n-1,k)$$
		$$S(n,1) = S(n,n) = 1$$
		$$S(n,k) = \frac{1}{k!}\sum_{j=0}^k (-1)^{k-j}\binom{k}{j}j^n$$

	\section{Bell numbers}
		Total number of partitions of $n$ distinct elements. $B(n) =$
		$1, 1, 2, 5, 15, 52, 203, 877, 4140, 21147, \dots$. For $p$ prime,
		\[ B(p^m+n)\equiv mB(n)+B(n+1) \pmod{p} \]

	\section{Catalan numbers}
		\[ C_n=\frac{1}{n+1}\binom{2n}{n}= \binom{2n}{n}-\binom{2n}{n+1} = \frac{(2n)!}{(n+1)!n!} \]
		\[ C_0=1,\ C_{n+1} = \frac{2(2n+1)}{n+2}C_n,\ C_{n+1}=\sum C_iC_{n-i} \]
		${C_n = 1, 1, 2, 5, 14, 42, 132, 429, 1430, 4862, 16796, 58786, \dots}$
		\begin{itemize}[noitemsep]
			\item sub-diagonal monotone paths in an $n\times n$ grid.
			\item strings with $n$ pairs of parenthesis, correctly nested.
			\item binary trees with with $n+1$ leaves (0 or 2 children).
			\item ordered trees with $n+1$ vertices.
			\item ways a convex polygon with $n+2$ sides can be cut into triangles by connecting vertices with straight lines.
			\item permutations of $[n]$ with no 3-term increasing subseq.
		\end{itemize}
\newpage
\boldmath
\setlength\columnsep{5mm}
\section{2D geometry}
\noindent
Define $\orient(A, B, C) = \vv{AB} \times \vv{AC}$. CCW iff $>0$. \\
Define $\prp((a, b)) = (-b, a)$. The vectors are orthogonal. \\
For line $ax + by = c$ def $\vv{v} = (-b, a)$. \\
Line through $P$ and $Q$ has $\vv{v} = \vv{PQ}$ and $c = \vv{v} \times P$. \\
$\side_l (P) = \vv{v_l} \times P - c_l$ sign determines which side $P$ is on from $l$. \\
$\dist_l (P) = \side_l (P) / \norm{v_l}$ squared is integer. \\
Sorting points along a line: comparator is $\vv{v} \cdot A < \vv{v} \cdot B$. \\
Translating line by $\vv{t}$: new line has $c' = c + \vv{v} \times \vv{t}$. \\
Line intersection: is $(c_{l} \vv{v}_m - c_m \vv{v}_l) / (\vv{v}_l \times \vv{v}_m)$. \\
Project $P$ onto $l$: is $P - \prp(v) \side_l(P) / \norm{v}^2$. \\
Angle bisectors: $\vv{v} = \vv{v}_l / \norm{\vv{v}_l} + \vv{v}_m / \norm{\vv{v}_m}$ \\
$c = c_l / \norm{\vv{v}_l} + c_m / \norm{\vv{v}_m}$. \\
$P$ is on segment $AB$ iff $\orient(A, B, P) = 0$ and $\vv{PA} \cdot \vv{PB} \le 0$. \\
Proper intersection of $AB$ and $CD$ exists iff $\orient(C, D, A)$ and $\orient(C, D, B)$
have opp. signs and $\orient(A, B, C)$ and $\orient(A, B, D)$ have opp. signs. Coordinates: \\
\begin{equation*}
  \frac{A \orient(C, D, B) - B \orient(C, D, A)}{\orient(C, D, B) - \orient(C, D, A)}.
\end{equation*}
Circumcircle center:
\lstinputlisting[firstline = 1, lastline = 4]{geometry_snippets.cpp}
Circle-line intersect:
\lstinputlisting[firstline = 7, lastline = 14]{geometry_snippets.cpp}
Circle-circle intersect:
\lstinputlisting[firstline = 17, lastline = 25]{geometry_snippets.cpp}
Tangent lines:
\lstinputlisting[firstline = 28, lastline = 36]{geometry_snippets.cpp}
\section{3D geometry}
\noindent
$\orient(P, Q, R, S) = (\vv{PQ} \times \vv{PR}) \cdot \vv{PS}$. \\
  $S$ above $PQR$ iff $>0$. \\
For plane $ax + by + cz = d$ def $\vv{n} = (a, b, c)$. \\
Line with normal $\vv{n}$ through point $P$ has $d = \vv{n} \cdot P$. \\
$\side_\Pi (P) = \vv{n} \cdot P - d$ sign determines side from $\Pi$. \\
$\dist_\Pi (P) = \side_\Pi (P) / \norm{\vv{n}}$. \\
Translating plane by $\vv{t}$ makes $d' = d + \vv{n} \cdot \vv{t}$. \\
Plane-plane intersection of has direction $\vv{n}_1 \times \vv{n}_2$ and
goes through $((d_1 \vv{n}_2 - d_2 \vv{n}_1) \times \vv{d}) / \norm{\vv{d}}^2$. \\
Line-line distance:
\lstinputlisting[firstline = 39, lastline = 43]{geometry_snippets.cpp}
Spherical to Cartesian: \\ $(r \cos \phi \cos \lambda, r \cos \phi \sin \lambda, r \sin \phi)$. \\
Sphere-line intersection:
\lstinputlisting[firstline = 46, lastline = 52]{geometry_snippets.cpp}
Great-circle distance between points $A$ and $B$ is $r \angle AOB$. \\
Spherical segment intersection:
\lstinputlisting[firstline = 55, lastline = 87]{geometry_snippets.cpp}
Angle between spherical segments $AB$ and $AC$ is angle between $A \times B$ and $A \times C$. \\
Oriented angle: subtract from $2\pi$ if mixed product is negative. \\
Area of a spherical polygon:
\begin{equation*}
  r^2 [ \text{sum of interior angles} - (n - 2)\pi ].
\end{equation*}
\end{multicols}
\includepdf[pages={-}, angle=90,pagecommand={\pagestyle{fancy}}]{codebookpart2}
\end{document}
